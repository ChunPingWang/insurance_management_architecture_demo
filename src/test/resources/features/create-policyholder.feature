Feature: 新增保戶資料 (US1)
  作為內勤人員
  我可以建立新保戶基本資料
  系統產生唯一保戶編號

  Background:
    Given 系統已啟動

  @smoke @us1
  Scenario: 成功建立新保戶
    When 我建立保戶資料:
      | 身分證字號 | 姓名   | 性別   | 生日       | 手機       | 電子郵件           | 郵遞區號 | 城市   | 區域   | 街道           |
      | A123456789 | 王小明 | MALE   | 1990-01-15 | 0912345678 | test@example.com   | 100      | 台北市 | 中正區 | 忠孝東路100號  |
    Then 系統回傳 201 狀態碼
    And 回傳資料包含保戶編號格式為 "PH" 加 10 位數字
    And 回傳資料的狀態為 "ACTIVE"
    And 回傳資料包含正確的保戶資訊

  @us1
  Scenario: 身分證字號已存在時無法建立
    Given 已存在身分證字號為 "A123456789" 的保戶
    When 我建立保戶資料:
      | 身分證字號 | 姓名   | 性別   | 生日       | 手機       | 電子郵件           | 郵遞區號 | 城市   | 區域   | 街道           |
      | A123456789 | 李大華 | MALE   | 1985-05-20 | 0987654321 | lee@example.com    | 100      | 台北市 | 大安區 | 敦化南路200號  |
    Then 系統回傳 400 狀態碼
    And 錯誤訊息包含 "already exists"

  @us1
  Scenario: 身分證字號格式不正確時無法建立
    When 我建立保戶資料:
      | 身分證字號 | 姓名   | 性別   | 生日       | 手機       | 電子郵件           | 郵遞區號 | 城市   | 區域   | 街道           |
      | 1234567890 | 王小明 | MALE   | 1990-01-15 | 0912345678 | test@example.com   | 100      | 台北市 | 中正區 | 忠孝東路100號  |
    Then 系統回傳 400 狀態碼

  @us1
  Scenario: 未滿18歲無法建立保戶
    When 我建立保戶資料:
      | 身分證字號 | 姓名   | 性別   | 生日       | 手機       | 電子郵件           | 郵遞區號 | 城市   | 區域   | 街道           |
      | A123456789 | 王小明 | MALE   | 2010-01-15 | 0912345678 | test@example.com   | 100      | 台北市 | 中正區 | 忠孝東路100號  |
    Then 系統回傳 400 狀態碼
    And 錯誤訊息包含 "18 years old"

  @us1
  Scenario: 缺少必填欄位時無法建立
    When 我建立保戶資料:
      | 身分證字號 | 姓名 | 性別 | 生日 | 手機 | 電子郵件 | 郵遞區號 | 城市 | 區域 | 街道 |
      |            |      |      |      |      |          |          |      |      |      |
    Then 系統回傳 400 狀態碼

  @us1
  Scenario: 電子郵件為選填欄位
    When 我建立保戶資料:
      | 身分證字號 | 姓名   | 性別   | 生日       | 手機       | 電子郵件 | 郵遞區號 | 城市   | 區域   | 街道           |
      | A123456789 | 王小明 | MALE   | 1990-01-15 | 0912345678 |          | 100      | 台北市 | 中正區 | 忠孝東路100號  |
    Then 系統回傳 201 狀態碼
    And 回傳資料的電子郵件為空
