# 保戶基本資料管理系統 - 產品需求文件 (PRD)

## 文件資訊

| 項目 | 內容 |
|------|------|
| 文件名稱 | 保戶基本資料管理系統 PRD |
| 版本 | 1.0.0 |
| 建立日期 | 2025-01-15 |
| 狀態 | Draft |

---

## 1. 產品概述

### 1.1 背景說明

人壽保險公司需要一套現代化的保戶基本資料管理系統，用於統一管理保戶的個人資訊與其持有的保單資料。本系統將作為保戶資料的單一事實來源（Single Source of Truth），提供標準化的 API 介面供內部系統與外部通路整合使用。

### 1.2 產品目標

1. 提供保戶基本資料的完整生命週期管理（CRUD）
2. 支援多種保單類型的關聯管理
3. 建立事件驅動的架構基礎，支援未來系統擴展
4. 提供符合 OpenAPI 規範的標準化 API

### 1.3 目標使用者

| 角色 | 說明 |
|------|------|
| 內勤人員 | 透過內部系統維護保戶資料 |
| 外勤業務員 | 透過行動裝置查詢保戶資訊 |
| 客服人員 | 快速查詢保戶與保單狀態 |
| 系統整合 | 其他內部系統透過 API 存取資料 |

---

## 2. 業務需求

### 2.1 保戶資料管理

#### 2.1.1 保戶基本資料欄位

| 欄位名稱 | 中文說明 | 資料類型 | 必填 | 備註 |
|----------|----------|----------|------|------|
| policyHolderId | 保戶編號 | String | 是 | 系統自動產生，格式：PH + 10位數字 |
| nationalId | 身分證字號 | String | 是 | 唯一值，需驗證格式 |
| name | 姓名 | String | 是 | 最大長度 50 字元 |
| gender | 性別 | Enum | 是 | MALE / FEMALE |
| birthDate | 出生日期 | Date | 是 | 需年滿 18 歲 |
| mobilePhone | 手機號碼 | String | 是 | 需驗證台灣手機格式 |
| email | 電子郵件 | String | 否 | 需驗證 Email 格式 |
| address | 通訊地址 | Object | 是 | 包含縣市、區域、街道、郵遞區號 |
| status | 保戶狀態 | Enum | 是 | ACTIVE / INACTIVE / SUSPENDED |
| createdAt | 建立時間 | DateTime | 是 | 系統自動產生 |
| updatedAt | 更新時間 | DateTime | 是 | 系統自動更新 |

#### 2.1.2 地址資料結構

| 欄位名稱 | 中文說明 | 資料類型 | 必填 |
|----------|----------|----------|------|
| zipCode | 郵遞區號 | String | 是 |
| city | 縣市 | String | 是 |
| district | 區域 | String | 是 |
| street | 街道地址 | String | 是 |

### 2.2 保單資料管理

#### 2.2.1 保單類型定義

| 保單類型 | 代碼 | 說明 |
|----------|------|------|
| 人壽險 | LIFE | 身故、全殘保障 |
| 意外險 | ACCIDENT | 意外傷害保障 |
| 平安險 | SAFETY | 綜合平安保障 |

#### 2.2.2 保單資料欄位

| 欄位名稱 | 中文說明 | 資料類型 | 必填 | 備註 |
|----------|----------|----------|------|------|
| policyId | 保單編號 | String | 是 | 系統自動產生 |
| policyNumber | 保單號碼 | String | 是 | 業務識別碼 |
| policyType | 保單類型 | Enum | 是 | LIFE / ACCIDENT / SAFETY |
| policyName | 保單名稱 | String | 是 | 商品名稱 |
| premiumAmount | 保費金額 | Decimal | 是 | 年繳保費 |
| sumInsured | 保險金額 | Decimal | 是 | 保額 |
| effectiveDate | 生效日期 | Date | 是 | 保單生效日 |
| expiryDate | 到期日期 | Date | 否 | 保單到期日（終身險無） |
| status | 保單狀態 | Enum | 是 | ACTIVE / LAPSED / TERMINATED |

---

## 3. 功能需求

### 3.1 保戶管理功能

#### 3.1.1 新增保戶 (Create)

**使用案例**：內勤人員建立新保戶資料

**前置條件**：
- 身分證字號未存在於系統中
- 所有必填欄位已填寫

**業務規則**：
1. 身分證字號需通過格式驗證
2. 出生日期需年滿 18 歲
3. 手機號碼需符合台灣格式（09xxxxxxxx）
4. 系統自動產生保戶編號
5. 初始狀態設為 ACTIVE
6. 發布 PolicyHolderCreated 事件

**成功結果**：
- 保戶資料成功建立
- 回傳完整保戶資料含保戶編號

#### 3.1.2 修改保戶 (Update)

**使用案例**：更新保戶聯絡資訊或基本資料

**前置條件**：
- 保戶存在且狀態非 SUSPENDED

**業務規則**：
1. 身分證字號不可修改
2. 保戶編號不可修改
3. 修改後自動更新 updatedAt
4. 發布 PolicyHolderUpdated 事件

**成功結果**：
- 保戶資料成功更新
- 回傳更新後的完整資料

#### 3.1.3 刪除保戶 (Delete)

**使用案例**：停用或刪除保戶資料

**前置條件**：
- 保戶存在

**業務規則**：
1. 採用軟刪除（狀態改為 INACTIVE）
2. 保留歷史資料供稽核
3. 發布 PolicyHolderDeleted 事件

**成功結果**：
- 保戶狀態變更為 INACTIVE

#### 3.1.4 查詢保戶 (Query)

**使用案例**：查詢單一保戶或保戶列表

**查詢條件**：

| 查詢類型 | 說明 |
|----------|------|
| 依保戶編號查詢 | 精確查詢單一保戶 |
| 依身分證查詢 | 精確查詢單一保戶 |
| 依姓名查詢 | 模糊搜尋 |
| 依狀態查詢 | 篩選特定狀態 |
| 列表查詢 | 分頁、排序、篩選 |

**成功結果**：
- 回傳符合條件的保戶資料
- 列表查詢包含分頁資訊

### 3.2 保單管理功能

#### 3.2.1 新增保單

**使用案例**：為保戶新增保單

**業務規則**：
1. 保戶必須存在且狀態為 ACTIVE
2. 保單號碼不可重複
3. 生效日期不可早於今日
4. 發布 PolicyAdded 事件

#### 3.2.2 查詢保戶保單

**使用案例**：查詢保戶持有的所有保單

**查詢條件**：
- 依保戶編號查詢
- 可篩選保單類型
- 可篩選保單狀態

---

## 4. 非功能需求

### 4.1 效能需求

| 項目 | 要求 |
|------|------|
| API 回應時間 | P95 < 200ms |
| 查詢回應時間 | P95 < 500ms（含分頁） |
| 並發處理 | 支援 100 concurrent users |

### 4.2 安全需求

| 項目 | 要求 |
|------|------|
| 資料加密 | 敏感資料（身分證）加密儲存 |
| API 認證 | 支援 JWT Token 驗證 |
| 稽核日誌 | 記錄所有資料異動 |

### 4.3 可用性需求

| 項目 | 要求 |
|------|------|
| 系統可用性 | 99.5% |
| 資料備份 | 每日備份 |
| 災難復原 | RPO < 24 小時 |

---

## 5. API 規格概要

### 5.1 保戶 API

| Method | Endpoint | 說明 |
|--------|----------|------|
| POST | /api/v1/policyholders | 新增保戶 |
| PUT | /api/v1/policyholders/{id} | 修改保戶 |
| DELETE | /api/v1/policyholders/{id} | 刪除保戶 |
| GET | /api/v1/policyholders/{id} | 查詢單一保戶 |
| GET | /api/v1/policyholders | 查詢保戶列表 |
| GET | /api/v1/policyholders/{id}/policies | 查詢保戶保單 |

### 5.2 保單 API

| Method | Endpoint | 說明 |
|--------|----------|------|
| POST | /api/v1/policyholders/{id}/policies | 新增保單 |
| GET | /api/v1/policies/{policyId} | 查詢單一保單 |

---

## 6. 領域事件清單

| 事件名稱 | 觸發時機 | 事件內容 |
|----------|----------|----------|
| PolicyHolderCreated | 新增保戶成功 | 保戶完整資料 |
| PolicyHolderUpdated | 修改保戶成功 | 變更前後資料 |
| PolicyHolderDeleted | 刪除保戶成功 | 保戶編號、刪除時間 |
| PolicyAdded | 新增保單成功 | 保戶編號、保單資料 |
| PolicyStatusChanged | 保單狀態變更 | 保單編號、前後狀態 |

---

## 7. 驗收標準

### 7.1 功能驗收

- [ ] 所有 CRUD API 功能正常運作
- [ ] 業務規則驗證正確
- [ ] 領域事件正確發布與持久化
- [ ] API 回傳格式符合 OpenAPI 規範

### 7.2 非功能驗收

- [ ] 效能符合需求規格
- [ ] 單元測試覆蓋率 > 80%
- [ ] API 文件完整

---

## 附錄 A：名詞定義

| 名詞 | 定義 |
|------|------|
| 保戶 (PolicyHolder) | 與保險公司簽訂保險契約的自然人 |
| 保單 (Policy) | 保險契約的書面憑證 |
| 保費 (Premium) | 要保人依契約約定應繳付的費用 |
| 保額 (Sum Insured) | 保險契約約定的最高賠償金額 |
